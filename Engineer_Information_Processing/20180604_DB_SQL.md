데이터베이스 실무 응용
=================
SQL
-----------------------
* 표준 관계형 데이터베이스 언어.
* 관계대수와 관계 해석을 기초로 한 혼합 데이터 언어
* 용도에 따라 DDL,DML,DCL로 사용

# **목차**
1. [DDL]()
2. [SELECT]()
3. [JOIN]()
4. [DML]()
5. [DCL]()
6. [VIEW]()

### DDL
#### DDL(Data Define Language)의 개념
* 스키마, 도메인, 테이블, 뷰, 인덱스를 정의하거나 변경 또는 제거할 때 사용하는 언어
* DDL로 정의된 내용은 메타데이터가 되며, 시스템 카탈로그에 저장
* 종류  
  * CREATE : 스키마,도메인,테이블,뷰,인덱스를 정의
  * ALTER : 테이블에 대한 정의를 변경
  * DROP : 스키마,도메인,테이블,뷰,트리거,인덱스를 제거

#### SQL에서 지원하는 기본 데이터 타입
* 정수(INT,SMALLINT) : INT->4바이트 SMALLINT->2바이트
* 실수(FLOAT,REAL,DOUBLE PRECISION)
* 형식화된 숫자 DEC(i,j) : i->전체 자리수 j:소수부 자릿수
* 고정길이 문자 CHAR(n) : n은 문자수
* 가변길이 문자 VARCHAR(n) : n은 최대 문자수
* 고정길이 비트 열(Bit String) : BIT(n)
* 가변길이 비트 열 : VARBIT(n)
* 날짜 : DATE
* 시간 : TIME

#### CREATE SCHEMA
* 스키마를 정의하는 명령문
* 스키마는 하나의 용응에 속하는 테이블과 기타 구성 요소 등을 그룹짓기 위한 것이다.
* 스키마의 식별을 위한 스키마 이름과 해당 스키마의 소유권자나 허가권자를 정의
* 표기형식
  * ***CREATE SCHEMA 스키마명 AUTHORIZARION 사용자_ID;***  
    * ID가 홍길동인 사용자의 스키마 '대학교'를 정의하는 SQL
      ```
      CREATE SCHEMA '대학교' AUTHORIZATION '홍길동';
      ```

#### CREATE DOMAIN
* 도메인(하나의 속성이 취할 수 있는 동일한 타입의 원자값들의 집합)을 정의하는 명령문
* 임의의 속성에서 취할 수 있는 값의 범위가 SQL에서 지원하는 전체 데이터 타입의 값이 아니고 일부분일때, 사용자는 그 값의 범위를 도메인으로 정의할 수 있음
* 정의된 도메인명은 일반적인 데이터 타입처럼 사용
* 표기형식
  * ***CREATE DOMAIN 도메인명 데이터_타입***  
  ***[DEFAULT 기본값]***  
  ***[CONSTRAINT 제약조건명 CHECK (범위 값)]***  
  * 성별을 '남' 또는 '여'와 같은 정해진 1개의 문자로 표현되는 도메인 SEX를 정의하는 SQL
    ```
    CREATE DOMAIN SEX
        DEFAULT '남'
        CONSTRAINT VALID_SEX CHECK (VALUE IN ('남','여'));
    ```
#### CREATE TABLE
* 테이블을 정의하는 명령문
* 표기형식
  * ***CREATE TABLE 테이블명  
  (속성명 데이터 타입[NOT NULL],...  
  ,[PRIMARY KEY(기본키_속성명, ...)]  
  ,[UNIQUE(대체키_속성명,...)]  
  ,[FOREIGN KEY(외래키_속성명,...)  
  REFERENCE 참조테이블(참조테이블_기본키_속성명)]  
  [ON DELETE 옵션]  
  [ON UPDATE 옵션]  
  ,[CONSTRAINT 제약조건명] [CHECK(조건식)]);***  
  ```
  * 이름,학번,전공,성별,생년월일로 구성된 학생 테이블을 정의하는 SQL문
  CREATE TABLE STUDENT
  (NAME VARCHAR(15) NOT NULL,
   ID CHAR(10),
   MAJOR CHAR(10),
   GENDER SEX,
   BIRTH DATE,
   PRIMARY KEY(ID), // ID CHAR(10) PRIMARY KEY선언으로 대체가능
   FOREIGN KEY(MAJOR)REFERENCE 학과(학과_ID),
   ON DELETE SET NULL,
   ON UPDATE CASCADE,
   CONSTRAINT 생년월일제약 CHECK(BIRTH >= 1980-01-01))
   //다음과 같이 외래키 지정 가능
   CONSTRAINT 제약명 FOREIGN KEY(MAJOR) REFERENCE 학과(학과_ID)
  ```
#### CREATE VIEW
* 뷰는 하나 이상의 기본 테이블로부터 유도되는 이름을 갖는 가상 테이블
* CREATE VIEW는 뷰를 정의하는 명령문이다.
* 표기형식
  * ***CREATE VIEW 뷰명[([속성명,속성명,...])]
  AS SELECT문(서브쿼리 : UNION이나 ORDER BY절을 사용할 수 없음)***  
  ```
  // 고객 테이블에서 주소가 '안산시'인 고객들의 성명과 전화번호를
  // '안산고객'이라는 뷰로 정의
  CREATE VIEW 안산고객
  AS SELECT 성명,전화번호
  FROM 고객
  WHERE 주소=안산
  ```
#### CREATE INDEX
* 인덱스는 검색을 빠르게 하기 위해 만든 보조적인 데이터 구조
* CREATE INDEX는 인덱스를 정의하는 명령문
* 표기형식
  * ***CREATE [UNIQUE] INDEX <인덱스명>  
  ON 테이블명,({속성명[ASC|DESC][,속성명[ASC|DESC]]})[CLUSTER];  
  cf) []안의 설명  
  UNIQUE : 이 키워드를 추가하면 중복값을 허용안함 추가안할경우 중복값 허용  
  ASC : 오름차순 / DESC : 내림차순  
  CLUSTER : 지정된 키에 따라 튜플들을 그룹으로 지정되기 위해 사용***  
  ```
  // 고객 테이블에서 UNIQUE한 특성을 갖는 고객번호 속성에 대해 내림차순으로 정렬하여
  // '고객번호_idx라는 이름으로 인덱스를 정의'
  CREATE UNIQUE INDEX 고객번호_idx  
  ON 고객(고객번호 DESC)  
  ```  

#### CREATE TRIGGER
* 트리거는 데이터베이스 시스템에서 데이터의 입력 갱신,삭제등의 이벤트가 발생할때 자동적으로 수행되는 사용자 정의 프로시져  
* 트리거는 SQL의 제약조건 방법을 통해 명시할 수 없는 무결성 제약조건을 구하고, 관련 테이블의 데이터를 일치시킬 때 주로 발생  
* 표기형식  
  * ***CREATE TRIGGER 트리거명 [BEFORE / AFTER][INSERT/DELETE/UPDATE] ON 테이블명  
  REFERENCING [NEW / OLD] TABLE AS 테이블명
  FOR EACH NOW  
  WHEN 조건식  
  트리거 BODY***
    * 동작시키옵션  
    BEFORE : 테이블이 변경되기전에 트리거가 실행  
    AFTER : 테이블이 변경된 후에 트리거가 실행  
    * 동작옵션  
    INSERT : 테이블에 새로운 레코드를 삽입될 때 트리거가 실행  
    DELETE : 테이블에 새로운 레코드를 삭제할 때 트리거가 실행  
    UPDATE : 테이블에 새로운 레코드를 수정할 때 트리거가 실행  
    * 테이블 선택 옵션  
    NEW : 새로 추가되거나 변경에 참여할 튜플들의 집합에 트리거가 적용  
    OLD : 변경된 튜플들의 집합에 트리거가 적용  
    * WHEN : 트리거가 실행되면서 지켜야할 조건을 지정  
    * 트리거 BODY  
      * BEGIN으로 시작해서 END로 끝나는데, 적어도 하나 이상의 SQL문이 있어야함(안그럼 에러)  
      * 변수의 값을 치환할 떄에는 예약어 SET을 사용  
  ```
  //학생 테이블 새로운 레코드가 삽입될 때, 삽입되는 레코드에 학년 정보가 누락됐으면
  //학년 필드에 신입생을 치환하는 트리거를 학년정보_tri라는 이름으로 정의하시오
  CREATE TRIGGER 학년정보_tri BEFORE INSERT ON 학생
  REFERENCING NEW TABLE AS new_table
  FOR EACH NOW
  WHEN new_table.학년=' '
  BEGIN
      SET new_table.학년 = '신입생'
  END;

  ```  
#### ALTER TABLE  
* 테이블에 대한 정의를 변경하는 명령문  
* 표기 형식  
  * ALTER TABLE 테이블명 ADD 속성명 데이터_타입[DEFAULT '기본값']; // 새로운 속성을 추가  
  * ALTER TABLE 테이블명 ALTER 속성명 [SET DEFAULT '기본값']; // 속성의 기본값을 변경  
  * ALTER TABLE 테이블명 DROP 속성명 [CASCADE]; // 속성을 제거  
  ```
  //학생 테이블에 최대 3문자로 구성되는 학년 속성을 추가하는 SQL문
  ALTER TABLE 학생 ADD 학년 VARCHAR(3);
  ```

#### DROP  
* 스키마, 도메인, 테이블, 뷰, 인덱스, 트리거를 제거하는 명령문  
* 표기 형식  
  * DROP SCHEMA 스키마명 [CASCADE | RESTRICT]; //스키마를 제거
  * DROP DOMAIN 도메인명 [CASCADE | RESTRICT]; //도메인을 제거
  * DROP TABLE 테이블명 [CASCADE | RESTRICT];  //테이블을 제거
  * DROP VIEW 뷰명 [CASCADE | RESTRICT]; // 뷰를 제거
  * DROP INDEX 인덱스명 [CASCADE | RESTRICT]; // 인덱스를 제거
  * DROP TRIGGER 트리거명 [CASCADE | RESTRICT]; // 트리거를 제거  
  * DROP CONSTRAINT 제약조건명; // 제약 조건을 제거
  * CASCADE : 제거할 개체를 참조하는 다른 모든 개체를 함계 제거
  * RESTRICT : 다른 개체가 제거할 개체를 참조중일 경우 제거가 취소
  ```
  //학생 테이블을 제거하는 SQL문
  DROP TABLE 학생 CASCADE;
